<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="300"
             x:Class="Unpacker.InstallActions"
             x:Name="Root"
             xmlns:local="clr-namespace:Unpacker" 
             x:DataType="local:InstallActions">

    <Panel>
        <!-- INPUT PAGE -->
        <Border Classes="card" Padding="20" IsVisible="{Binding !IsInstalling}">
            <StackPanel Spacing="20">
                <StackPanel Spacing="8">
                    <TextBlock Text="Source File" FontSize="12" Foreground="#888"/>
                    
                    <Border CornerRadius="6" 
                            BorderThickness="1" 
                            BorderBrush="#333" 
                            Background="#1E1E1E"
                            ClipToBounds="True">
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBox Grid.Column="0" 
                                     Text="{Binding SourcePath}"
                                     Watermark="~/Downloads/package.tar.gz"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     CornerRadius="0"
                                     Padding="12,12"/>
                            
                            <Button Grid.Column="1" 
                                    Click="OnBrowseClick"
                                    Classes="icon"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    CornerRadius="0"
                                    Margin="0">
                                <StackPanel Orientation="Horizontal" Spacing="8" Margin="10,0">
                                    <PathIcon Data="M20,6h-8l-2-2H4C2.9,4,2.01,4.9,2.01,6L2,18c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V8C22,6.9,21.1,6,20,6z M20,18H4V8h16V18z"
                                              Width="16" Height="16" Foreground="#CCC"/>
                                    <TextBlock Text="Browse" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>
                </StackPanel>

                <local:AppInfoCard AppName="{Binding AppName, Mode=TwoWay}" 
                                   AppVersion="{Binding AppVersion, Mode=TwoWay}"/>

                <Expander Header="Advanced Options" 
                          CornerRadius="8"
                          Background="#252525">
                    <StackPanel Spacing="10" Margin="10">
                        <CheckBox IsChecked="True" Content="Create Desktop Entry (.desktop)" />
                        <CheckBox IsChecked="{Binding IsSystemWide, Mode=TwoWay}" 
                                  Content="Install System Wide (Requires /opt/ permissions)" />
                    </StackPanel>
                </Expander>

                <Button Classes="primary" 
                        Click="OnInstallClick"
                        HorizontalAlignment="Stretch" 
                        Height="50">
                    <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                        <PathIcon Data="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"
                                  Width="18" 
                                  Height="18" 
                                  Foreground="Black"
                                  Opacity="{Binding ShieldOpacity}"/>
                        <TextBlock Text="{Binding InstallButtonText}" 
                                   FontWeight="Bold" 
                                   FontSize="16"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <!-- PROGRESS PAGE -->
        <Border Classes="card" Padding="20" IsVisible="{Binding IsInstalling}">
            <Grid RowDefinitions="Auto, *, Auto">
                <TextBlock Grid.Row="0" 
                           Text="Installation Progress" 
                           FontSize="18" 
                           FontWeight="Bold" 
                           Margin="0,0,0,10"/>
                
                <Border Grid.Row="1" 
                        CornerRadius="8" 
                        Background="#000" 
                        BorderBrush="#333" 
                        BorderThickness="1"
                        Padding="10">
                    <TextBox Text="{Binding InstallationLogs}"
                             IsReadOnly="True"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             FontFamily="Monospace"
                             FontSize="12"
                             Background="Transparent"
                             Foreground="#00FF00"
                             BorderThickness="0"
                             CaretIndex="{Binding LogCaretIndex}"/> 
                             <!-- Note: LogCaretIndex to auto-scroll needing code-behind logic or auto-scroll behavior -->
                </Border>

                <Button Grid.Row="2" 
                        Content="Back / Done"
                        Margin="0,15,0,0"
                        HorizontalAlignment="Right"
                        Command="{Binding ResetViewCommand}" 
                        IsEnabled="{Binding IsInstallationDone}"/>
            </Grid>
        </Border>
    </Panel>
</UserControl>